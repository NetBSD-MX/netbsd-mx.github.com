<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Grupo de Usuarios de NetBSD en MÃ©xico</title><link href="http://www.netbsd.mx/" rel="alternate"></link><link href="http://www.netbsd.mx/feeds/firewall-tag.atom.xml" rel="self"></link><id>http://www.netbsd.mx/</id><updated>2013-07-14T02:30:00-05:00</updated><entry><title>PPPoE</title><link href="http://www.netbsd.mx/pppoe.html" rel="alternate"></link><updated>2013-07-14T02:30:00-05:00</updated><author><name>Francisco Valladolid</name></author><id>tag:www.netbsd.mx,2013-07-14:pppoe.html</id><summary type="html">&lt;div class="section" id="introducccion"&gt;
&lt;h2&gt;Introducccion:&lt;/h2&gt;
&lt;p&gt;Algunas ocasiones necesitamos establecer una conexion PPPoE (Point to Point over
Ethernet)  a internet via ADSL, los routers actuales
pueden hacer &lt;a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?pppoe++NetBSD-current"&gt;pppoe&lt;/a&gt; de forma sencilla, sin embargo en algunos entornos donde
se necesita control de la conexion podemos usar nuestro router casero en modo bridge
y usar &lt;a class="reference external" href="http://www.netbsd.org"&gt;NetBSD&lt;/a&gt; como pppoe/router/firewall/dns cache y tener el control de nuestra red
casera.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="requerimientos"&gt;
&lt;h2&gt;Requerimientos:&lt;/h2&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Una PC corriendo &lt;a class="reference external" href="http://www.netbsd.org"&gt;NetBSD&lt;/a&gt; (&lt;a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?pppoe++NetBSD-current"&gt;pppoe&lt;/a&gt; es soportado desde 1.6)&lt;/li&gt;
&lt;li&gt;Dos tarjetas de red (una para el bridge, otra para la red interna)&lt;/li&gt;
&lt;li&gt;Un editor de textos&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class="section" id="configuracion"&gt;
&lt;h2&gt;Configuracion:&lt;/h2&gt;
&lt;p&gt;Suponiendo fxp0 la interfase que conecta al modem ADSL, editamos
&lt;em&gt;/etc/ifconfig.ppoe&lt;/em&gt; sino existe lo creamos y agregamos lo siguiente:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
create
!&amp;nbsp;/sbin/ifconfig&amp;nbsp;fxp0&amp;nbsp;up
!&amp;nbsp;/sbin/pppoectl&amp;nbsp;-e&amp;nbsp;fxp0&amp;nbsp;$int
!&amp;nbsp;/sbin/pppoectl&amp;nbsp;$int&amp;nbsp;myauthproto=pap&amp;nbsp;'myauthname=tu_nombre_de_usuario' \
     'myauthsecret=tu_password'&amp;nbsp;hisauthproto=none
       inet&amp;nbsp;0.0.0.0&amp;nbsp;0.0.0.1&amp;nbsp;netmask&amp;nbsp;0xffffffff
#!&amp;nbsp;/sbin/route&amp;nbsp;add&amp;nbsp;default&amp;nbsp;-iface&amp;nbsp;0.0.0.1
up
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Agregamos ifwatchd al rc.conf para monitorear la conexion.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;#&amp;nbsp;echo&amp;nbsp;&amp;quot;ifwatchd&amp;nbsp;=&amp;nbsp;YES&amp;quot;&amp;nbsp;&amp;gt;&amp;gt;&amp;nbsp;/etc/rc.conf&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Es necesario bajar el valor del MTU para las interfaces, un valor MTU
alto quiza cause algunos problemas a nuestra conexion, entonces
modificamos dentro de &lt;em&gt;/etc/sysctl.conf&lt;/em&gt;:&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;&amp;nbsp;net.inet.tcp.mss_ifmtu=1&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Si quiere hacer NAT a su red interna, entonces, necesita agregar lo
siguiente a su archivo &lt;em&gt;rc.conf&lt;/em&gt;&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# sysctl -w net.inet.ip.forwarding=1
# echo &amp;quot;ipf=YES&amp;quot; &amp;gt;&amp;gt; /etc/rc.conf
# echo &amp;quot;ipnat=YES&amp;quot; &amp;gt;&amp;gt; /etc/rc.conf
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="haciendo-nat"&gt;
&lt;h2&gt;Haciendo NAT&lt;/h2&gt;
&lt;p&gt;Agregar las reglas nat a ipnat.conf, suponiendo que esta usando
192.168.1.0/24&lt;/p&gt;
&lt;pre class="literal-block"&gt;
map&amp;nbsp;pppoe0&amp;nbsp;192.168.1.0/24&amp;nbsp;-&amp;gt;&amp;nbsp;0/32&amp;nbsp;portmap&amp;nbsp;tcp/udp&amp;nbsp;44000:49999&amp;nbsp;mssclamp 1440
map&amp;nbsp;pppoe0&amp;nbsp;192.168.1.0/24&amp;nbsp;-&amp;gt;&amp;nbsp;0/32&amp;nbsp;mssclamp&amp;nbsp;1440
&lt;/pre&gt;
&lt;p&gt;Con esta configuracion &lt;a class="reference external" href="http://www.netbsd.org"&gt;NetBSD&lt;/a&gt; esta actuando como servidor &lt;a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?pppoe++NetBSD-current"&gt;pppoe&lt;/a&gt; y haciendo NAT a la red inerna
via &lt;a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?ipnat++NetBSD-current"&gt;ipnat&lt;/a&gt; e &lt;a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?ipf++NetBSD-current"&gt;ipf&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="consideraciones"&gt;
&lt;h2&gt;Consideraciones:&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://www.netbsd.org"&gt;NetBSD&lt;/a&gt; ahora incluye un filtro de paquetes en base llamado &lt;a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?npf++NetBSD-current"&gt;npf&lt;/a&gt; para hacer NAT y
filtrado de paquetes, la configuracion para ello varia en mucho en comparacion a &lt;a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?ipf++NetBSD-current"&gt;ipf&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="pppoe"></category><category term="redes"></category><category term="nat"></category><category term="firewall"></category><category term="ipf"></category><category term="ipnat"></category></entry></feed>