<!DOCTYPE html>
<html lang="es">

<head>
  <link rel="stylesheet/less" type="text/css" href="./theme/css/style.less">
  <script src="./theme/js/less-1.3.3.min.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" type="text/css" href="./theme/css/style.css"> -->

  <link rel="stylesheet" type="text/css" href="./theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width; initial-scale=1.0">
  <meta name="author" content="">
  <meta name="description" content="Posts and writings by ">

  <link href="http://www.netbsd.mx/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Grupo de Usuarios de NetBSD en México Full Atom Feed" />
  <link href="http://www.netbsd.mx/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Grupo de Usuarios de NetBSD en México Full RSS Feed" />

<meta name="keywords" content="pppoe, redes, nat, firewall, ipf, ipnat">

  <title>
PPPoE  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-13168762-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href=".">
        <img src="./theme/images/logo.png" alt="logo">
      </a>
      <h2><a href="."></a></h2>
      <p></p>
      <ul>
        <li><a href="http://www.netbsd.org" target="_blank">NetBSD</a></li>
        <li><a href="http://twitter.com/netbsdmx" target="_blank">twitter</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
<p>Posted on domingo, 14 de julio de 2013</p>
    </header>

<article>
  <div id="article_title">
    <h3><a href="./pppoe.html">PPPoE</a></h3>
  </div>
  <div id="article_text">
    <div class="section" id="introducccion">
<h2>Introducccion:</h2>
<p>Algunas ocasiones necesitamos establecer una conexion PPPoE (Point to Point over
Ethernet)  a internet via ADSL, los routers actuales
pueden hacer <a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?pppoe++NetBSD-current">pppoe</a> de forma sencilla, sin embargo en algunos entornos donde
se necesita control de la conexion podemos usar nuestro router casero en modo bridge
y usar <a class="reference external" href="http://www.netbsd.org">NetBSD</a> como pppoe/router/firewall/dns cache y tener el control de nuestra red
casera.</p>
</div>
<div class="section" id="requerimientos">
<h2>Requerimientos:</h2>
<blockquote>
<ul class="simple">
<li>Una PC corriendo <a class="reference external" href="http://www.netbsd.org">NetBSD</a> (<a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?pppoe++NetBSD-current">pppoe</a> es soportado desde 1.6)</li>
<li>Dos tarjetas de red (una para el bridge, otra para la red interna)</li>
<li>Un editor de textos</li>
</ul>
</blockquote>
</div>
<div class="section" id="configuracion">
<h2>Configuracion:</h2>
<p>Suponiendo fxp0 la interfase que conecta al modem ADSL, editamos
<em>/etc/ifconfig.ppoe</em> sino existe lo creamos y agregamos lo siguiente:</p>
<pre class="literal-block">
create
!&nbsp;/sbin/ifconfig&nbsp;fxp0&nbsp;up
!&nbsp;/sbin/pppoectl&nbsp;-e&nbsp;fxp0&nbsp;$int
!&nbsp;/sbin/pppoectl&nbsp;$int&nbsp;myauthproto=pap&nbsp;'myauthname=tu_nombre_de_usuario' \
     'myauthsecret=tu_password'&nbsp;hisauthproto=none
       inet&nbsp;0.0.0.0&nbsp;0.0.0.1&nbsp;netmask&nbsp;0xffffffff
#!&nbsp;/sbin/route&nbsp;add&nbsp;default&nbsp;-iface&nbsp;0.0.0.1
up
</pre>
<p><strong>Agregamos ifwatchd al rc.conf para monitorear la conexion.</strong></p>
<p><tt class="docutils literal"><span class="pre">#&nbsp;echo&nbsp;&quot;ifwatchd&nbsp;=&nbsp;YES&quot;&nbsp;&gt;&gt;&nbsp;/etc/rc.conf</span></tt></p>
<p>Es necesario bajar el valor del MTU para las interfaces, un valor MTU
alto quiza cause algunos problemas a nuestra conexion, entonces
modificamos dentro de <em>/etc/sysctl.conf</em>:</p>
<p><tt class="docutils literal">&nbsp;net.inet.tcp.mss_ifmtu=1</tt></p>
<p>Si quiere hacer NAT a su red interna, entonces, necesita agregar lo
siguiente a su archivo <em>rc.conf</em></p>
<pre class="literal-block">
# sysctl -w net.inet.ip.forwarding=1
# echo &quot;ipf=YES&quot; &gt;&gt; /etc/rc.conf
# echo &quot;ipnat=YES&quot; &gt;&gt; /etc/rc.conf
</pre>
</div>
<div class="section" id="haciendo-nat">
<h2>Haciendo NAT</h2>
<p>Agregar las reglas nat a ipnat.conf, suponiendo que esta usando
192.168.1.0/24</p>
<pre class="literal-block">
map&nbsp;pppoe0&nbsp;192.168.1.0/24&nbsp;-&gt;&nbsp;0/32&nbsp;portmap&nbsp;tcp/udp&nbsp;44000:49999&nbsp;mssclamp 1440
map&nbsp;pppoe0&nbsp;192.168.1.0/24&nbsp;-&gt;&nbsp;0/32&nbsp;mssclamp&nbsp;1440
</pre>
<p>Con esta configuracion <a class="reference external" href="http://www.netbsd.org">NetBSD</a> esta actuando como servidor <a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?pppoe++NetBSD-current">pppoe</a> y haciendo NAT a la red inerna
via <a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?ipnat++NetBSD-current">ipnat</a> e <a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?ipf++NetBSD-current">ipf</a></p>
</div>
<div class="section" id="consideraciones">
<h2>Consideraciones:</h2>
<p><a class="reference external" href="http://www.netbsd.org">NetBSD</a> ahora incluye un filtro de paquetes en base llamado <a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?npf++NetBSD-current">npf</a> para hacer NAT y
filtrado de paquetes, la configuracion para ello varia en mucho en comparacion a <a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?ipf++NetBSD-current">ipf</a>.</p>
</div>

  </div>
  <div id="article_meta">
    <p>Category: <a href="./category/redes.html">redes</a></p>
    <p>Tags:
      <a href="./tag/pppoe.html">pppoe</a>,      <a href="./tag/redes.html">redes</a>,      <a href="./tag/nat.html">nat</a>,      <a href="./tag/firewall.html">firewall</a>,      <a href="./tag/ipf.html">ipf</a>,      <a href="./tag/ipnat.html">ipnat</a>    </p>
  </div>
</article>

    <footer>
<p><a href="./" class="button_accent">&larr; Back to Index</a></p>
    </footer>

    <div id="ending_message">
      <p>&copy Giulio Fidente. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. You can fork the theme on <a href="https://github.com/giulivo/pelican-svbhack" target="_blank">github</a>.</p>
    </div>
  </main>
</body>
</html>